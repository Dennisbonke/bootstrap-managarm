sources:
  - name: extra-cmake-modules
    subdir: 'ports'
    git: 'https://github.com/KDE/extra-cmake-modules.git'
    tag: 'v5.249.0'
    version: '6.0rc2'

tools:
  - name: host-ecm
    architecture: noarch
    from_source: extra-cmake-modules
    tools_required:
      - host-cmake
      - host-ninja
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_INSTALL_PREFIX=@PREFIX@'
        - '@THIS_SOURCE_DIR@'
    compile:
      - args: ['cmake', '--build', '.', '--parallel', '@PARALLELISM@']
    install:
      - args: ['cmake', '--install', '.']

packages:
  - name: kconfig
    architecture: '@OPTION:arch@'
    metadata:
      summary: Framework for reading and writing configuration
      description: This package provides a framework for reading and writing configuration.
      spdx: 'LGPL-2.0-or-later'
      website: 'https://develop.kde.org/products/frameworks/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['kde-frameworks']
    source:
      subdir: 'ports'
      git: 'https://github.com/KDE/kconfig.git'
      tag: 'v5.249.0' # Yes this is 6.0rc2
      version: '6.0rc2'
    tools_required:
      - system-gcc
      - host-cmake
      - host-qt6
      - host-ecm
    pkgs_required:
      - mlibc
      - qtbase6
      - qtdeclarative6
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DECM_DIR=@BUILD_ROOT@/tools/host-ecm'
        - '-DCMAKE_BUILD_TYPE=Debug'
        ### from ecm.class
        - '-DQT_MAJOR_VERSION=6'
        - '-DBUILD_TESTING=OFF'
        - '-DBUILD_QCH=FALSE'
        - '-DKDE_INSTALL_USE_QT_SYS_PATHS=ON'
        - '-DKDE_INSTALL_QMLDIR=/usr/lib/qt6/qml'
        - '-DKDE_INSTALL_PLUGINDIR=/usr/lib/qt6/plugins'
        - '-DKDE_INSTALL_QTPLUGINDIR=/usr/lib/qt6/plugins'
        ### end ecm.class
        - '-DKF_IGNORE_PLATFORM_CHECK=TRUE' # We're porting, and this is the recommended way to do it.
        - '-DKCONFIG_USE_DBUS=TRUE'
        - '-DKCONFIG_USE_QML=TRUE'
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'

  - name: kcoreaddons
    architecture: '@OPTION:arch@'
    metadata:
      summary: Framework for solving common problems such as caching, randomisation, and more
      description: This package provides a framework for solving common problems such as caching, randomisation, and more.
      spdx: 'LGPL-2.0-or-later'
      website: 'https://develop.kde.org/products/frameworks/'
      maintainer: "Dennis Bonke <dennis@managarm.org>"
      categories: ['kde-frameworks']
    source:
      subdir: 'ports'
      git: 'https://github.com/KDE/kcoreaddons.git'
      tag: 'v5.249.0' # Yes this is 6.0rc2
      version: '6.0rc2'
    tools_required:
      - system-gcc
      - host-cmake
      - host-qt6
      - host-ecm
    pkgs_required:
      - mlibc
      - qtbase6
      - qtdeclarative6
      - eudev
    configure:
      - args:
        - 'cmake'
        - '-GNinja'
        - '-DCMAKE_INSTALL_PREFIX=/usr'
        - '-DCMAKE_TOOLCHAIN_FILE=@SOURCE_ROOT@/scripts/CMakeToolchain-@OPTION:arch-triple@.txt'
        - '-DECM_DIR=@BUILD_ROOT@/tools/host-ecm'
        - '-DCMAKE_BUILD_TYPE=Debug'
        ### from ecm.class
        - '-DQT_MAJOR_VERSION=6'
        - '-DBUILD_TESTING=OFF'
        - '-DBUILD_QCH=FALSE'
        - '-DKDE_INSTALL_USE_QT_SYS_PATHS=ON'
        ### end ecm.class
        - '-DKF_IGNORE_PLATFORM_CHECK=TRUE' # We're porting, and this is the recommended way to do it.
        - '@THIS_SOURCE_DIR@'
    build:
      - args: ['ninja']
      - args: ['ninja', 'install']
        environ:
          DESTDIR: '@THIS_COLLECT_DIR@'
